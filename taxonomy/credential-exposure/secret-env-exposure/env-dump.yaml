id: "credential-exposure/secret-env-exposure/env-dump"
version: "1.0.0"
kingdom: "Credential & Secret Exposure"
kingdom_id: 2
category: "Secret Environment Exposure"
category_id: "2.3"
name: "Environment Variable Dump"
risk_level: "high"

abstract: |
  A command dumps all environment variables, potentially exposing API keys,
  tokens, passwords, and cloud credentials stored in the environment.

explanation: |
  Commands like `env`, `printenv`, and `set` output all environment variables.
  Developer workstations commonly have secrets in environment variables:
  - AWS_SECRET_ACCESS_KEY, AWS_ACCESS_KEY_ID
  - GITHUB_TOKEN, GH_TOKEN
  - DATABASE_URL (often contains passwords)
  - API_KEY, SECRET_KEY, AUTH_TOKEN

  AI agents may dump the environment when debugging or "checking configuration,"
  inadvertently exposing secrets in their output or logs.

recommendation: |
  - Audit all environment dump commands rather than blocking outright.
  - Redact known secret variable names from agent output.
  - Prefer targeted variable access (echo $PATH) over full dumps.
  - Use a secrets manager instead of environment variables where possible.

examples:
  bad:
    - "env"
    - "printenv"
    - "set"
    - "export"
  good:
    - "echo $PATH"
    - "echo $HOME"
    - "printenv SHELL"

compliance:
  owasp-llm-2025: ["LLM02", "LLM06"]

references:
  mitre_attack: ["T1082"]
  cwe: ["CWE-526"]
  external:
    - title: "MITRE ATT&CK: System Information Discovery"
      url: "https://attack.mitre.org/techniques/T1082/"

analyzers: ["regex", "semantic"]
related_rules: ["sec-audit-env-dump"]
